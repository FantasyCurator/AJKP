<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Employee & Family Form</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
  <style>
    body { background: #f8f9fa; }
    .card { margin-bottom: 20px; }
    .required:after { content:" *"; color:red; }
    .table thead { background: #1a3a6c; color: #fff; }
  </style>
</head>
<body class="container py-4">

  <h3 class="mb-4 text-center">Employee & Family Information</h3>

  <!-- Employee Form -->
  <div class="card">
    <div class="card-header">Employee Details</div>
    <div class="card-body">
      <form id="employeeForm">
        <div class="mb-3">
          <label class="form-label required">Posting Place</label>
          <select class="form-select" id="postingPlace" required>
            <option value="" disabled selected>Select</option>
            <option value="Region Office">Region Office</option>
            <option value="Mirpur">District Mirpur</option>
            <option value="Kotli">District Kotli</option>
            <option value="Bhimber">District Bhimber</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label required">Full Name</label>
          <input type="text" class="form-control" id="fullName" required>
        </div>
        <div class="mb-3">
          <label class="form-label required">Designation</label>
          <input type="text" class="form-control" id="designation" required>
        </div>
        <div class="mb-3">
          <label class="form-label required">Employee CNIC</label>
          <input type="text" class="form-control" id="employeeCnic" maxlength="13" pattern="[0-9]{13}" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Email</label>
          <input type="email" class="form-control" id="email">
        </div>
        <div class="mb-3">
          <label class="form-label">Mobile</label>
          <input type="text" class="form-control" id="mobile">
        </div>
        <div class="mb-3">
          <label class="form-label">Blood Group</label>
          <input type="text" class="form-control" id="blood">
        </div>
        <button type="button" class="btn btn-primary" id="addFamilyBtn">Add Family Member</button>
      </form>
    </div>
  </div>

  <!-- Family Form -->
  <div class="card" id="familyFormCard" style="display:none;">
    <div class="card-header">Add Family Member</div>
    <div class="card-body">
      <form id="familyForm">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label required">Relationship</label>
            <select class="form-select" id="relationship" required>
              <option value="" disabled selected>Select</option>
              <option value="Father">Father</option>
              <option value="Mother">Mother</option>
              <option value="Wife">Wife</option>
              <option value="Husband">Husband</option>
              <option value="Son">Son</option>
              <option value="Daughter">Daughter</option>
              <option value="Special Child">Special Child</option>
            </select>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label required">Full Name</label>
            <input type="text" class="form-control" id="familyName" required>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label required">CNIC</label>
            <input type="text" class="form-control" id="familyCnic" maxlength="13" pattern="[0-9]{13}" required>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label required">Date of Birth</label>
            <input type="date" class="form-control" id="dob" required>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label required">Marital Status</label>
            <select class="form-select" id="maritalStatus" required>
              <option value="" disabled selected>Select</option>
              <option value="Married">Married</option>
              <option value="Unmarried">Unmarried</option>
            </select>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label required">Job Status</label>
            <select class="form-select" id="jobStatus" required>
              <option value="" disabled selected>Select</option>
              <option value="Employed">Yes</option>
              <option value="Unemployed">No</option>
            </select>
          </div>
        </div>
        <button type="button" class="btn btn-success" id="addNewRecordBtn">Add Record</button>
      </form>
    </div>
  </div>

  <!-- Family Table -->
  <div class="card">
    <div class="card-header">Family Members</div>
    <div class="card-body">
      <table class="table table-bordered" id="familyTable" style="display:none;">
        <thead>
          <tr>
            <th>#</th>
            <th>Relationship</th>
            <th>Name</th>
            <th>CNIC</th>
            <th>DOB</th>
            <th>Marital Status</th>
            <th>Job Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="familyMembers"></tbody>
      </table>
      <div id="noFamilyMsg" class="text-muted text-center">No family members added yet.</div>
    </div>
  </div>

  <!-- Submit -->
  <div class="text-center mt-3">
    <button class="btn btn-danger" id="submitBtn">Submit All</button>
    <div id="submitStatus" class="mt-2 text-primary"></div>
  </div>

<script>
const scriptURL = "PASTE_YOUR_WEB_APP_URL_HERE";

let familyData = [];

document.getElementById("addFamilyBtn").onclick = () => {
  document.getElementById("familyFormCard").style.display = "block";
};

document.getElementById("addNewRecordBtn").onclick = () => {
  const rel = relationship.value;
  const name = familyName.value;
  const cnic = familyCnic.value;
  const dob = dob.value;
  const ms = maritalStatus.value;
  const js = jobStatus.value;

  if(!rel || !name || !cnic || !dob || !ms || !js) {
    alert("Fill all family fields!");
    return;
  }

  familyData.push({relationship: rel, name, cnic, dob, maritalStatus: ms, jobStatus: js});
  renderTable();
  document.getElementById("familyForm").reset();
};

function renderTable(){
  const tbody = document.getElementById("familyMembers");
  tbody.innerHTML = "";
  familyData.forEach((f,i)=>{
    tbody.innerHTML += `
      <tr>
        <td>${i+1}</td>
        <td>${f.relationship}</td>
        <td>${f.name}</td>
        <td>${f.cnic}</td>
        <td>${f.dob}</td>
        <td>${f.maritalStatus}</td>
        <td>${f.jobStatus}</td>
        <td>
          <button class="btn btn-sm btn-danger" onclick="deleteRow(${i})">Delete</button>
        </td>
      </tr>`;
  });
  document.getElementById("familyTable").style.display = familyData.length? "table":"none";
  document.getElementById("noFamilyMsg").style.display = familyData.length? "none":"block";
}

function deleteRow(i){
  familyData.splice(i,1);
  renderTable();
}

document.getElementById("submitBtn").onclick = () => {
  const emp = {
    postingPlace: postingPlace.value,
    fullName: fullName.value,
    designation: designation.value,
    employeeCnic: employeeCnic.value,
    email: email.value,
    mobile: mobile.value,
    bloodGroup: blood.value
  };

  fetch(scriptURL,{
    method:"POST",
    body: JSON.stringify({employee: emp, familyMembers: familyData})
  })
  .then(r=>r.json())
  .then(res=>{
    if(res.status=="success"){
      submitStatus.innerText = "Data saved successfully!";
      document.getElementById("employeeForm").reset();
      familyData=[];
      renderTable();
    } else {
      submitStatus.innerText = "Error: "+res.message;
    }
  })
  .catch(err=> submitStatus.innerText="Error: "+err.message);
};
</script>
</body>
</html>
