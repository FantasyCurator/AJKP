<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Employee & Family Form</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-4">
  <h3 class="text-center mb-4">Employee & Family Details Form</h3>

  <!-- Employee Form -->
  <form id="employeeForm" class="card p-3 mb-4 shadow-sm">
    <h5 class="mb-3">Employee Information</h5>

    <div class="mb-3">
      <label class="form-label">Posting Place *</label>
      <select class="form-select" id="postingPlace" required>
        <option value="">Select Posting Place</option>
        <option value="Region Office">Region Office</option>
        <option value="Mirpur">District Mirpur</option>
        <option value="Kotli">District Kotli</option>
        <option value="Bhimber">District Bhimber</option>
      </select>
    </div>

    <div class="mb-3">
      <label class="form-label">Full Name *</label>
      <input type="text" class="form-control" id="fullName" required>
    </div>

    <div class="mb-3">
      <label class="form-label">Designation *</label>
      <input type="text" class="form-control" id="designation" required>
    </div>

    <div class="mb-3">
      <label class="form-label">Employee CNIC *</label>
      <input type="text" class="form-control" id="employeeCnic" maxlength="13" pattern="[0-9]{13}" required>
    </div>

    <div class="mb-3">
      <label class="form-label">Email</label>
      <input type="email" class="form-control" id="email">
    </div>

    <div class="mb-3">
      <label class="form-label">Mobile</label>
      <input type="text" class="form-control" id="mobile">
    </div>

    <div class="mb-3">
      <label class="form-label">Blood Group</label>
      <input type="text" class="form-control" id="bloodGroup">
    </div>

    <button type="button" class="btn btn-primary" id="addFamilyBtn">Add Family Member</button>
  </form>

  <!-- Family Form -->
  <div id="familyFormContainer" class="card p-3 mb-4 shadow-sm" style="display:none;">
    <h5 class="mb-3">Add Family Member</h5>

    <form id="familyForm">
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">Relationship *</label>
          <select class="form-select" id="relationship" required>
            <option value="">Select</option>
            <option value="Father">Father</option>
            <option value="Mother">Mother</option>
            <option value="Wife">Wife</option>
            <option value="Husband">Husband</option>
            <option value="Son">Son</option>
            <option value="Daughter">Daughter</option>
            <option value="Special Child">Special Child</option>
          </select>
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label">Full Name *</label>
          <input type="text" class="form-control" id="familyName" required>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">CNIC *</label>
          <input type="text" class="form-control" id="cnic" maxlength="13" pattern="[0-9]{13}" required>
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label">Date of Birth *</label>
          <input type="date" class="form-control" id="dob" required>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">Marital Status *</label>
          <select class="form-select" id="maritalStatus" required>
            <option value="">Select</option>
            <option value="Married">Married</option>
            <option value="Unmarried">Unmarried</option>
          </select>
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label">Gender *</label>
          <select class="form-select" id="gender" required>
            <option value="">Select</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
          </select>
        </div>
      </div>

      <button type="button" class="btn btn-success" id="addFamilyRecord">Add New Record</button>
    </form>
  </div>

  <!-- Family Table -->
  <div class="card p-3 mb-4 shadow-sm">
    <h5 class="mb-3">Family Members</h5>
    <table class="table table-bordered" id="familyTable">
      <thead>
        <tr>
          <th>Relationship</th>
          <th>Name</th>
          <th>CNIC</th>
          <th>DOB</th>
          <th>Marital Status</th>
          <th>Gender</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Submit -->
  <div class="text-center">
    <button class="btn btn-primary" id="submitAll">Submit All Information</button>
    <p id="responseMessage" class="mt-3"></p>
  </div>
</div>

<script>
let familyMembers = [];

document.getElementById("addFamilyBtn").addEventListener("click", () => {
  document.getElementById("familyFormContainer").style.display = "block";
});

document.getElementById("addFamilyRecord").addEventListener("click", () => {
  const relationship = document.getElementById("relationship").value;
  const name = document.getElementById("familyName").value;
  const cnic = document.getElementById("cnic").value;
  const dob = document.getElementById("dob").value;
  const maritalStatus = document.getElementById("maritalStatus").value;
  const gender = document.getElementById("gender").value;

  if (!relationship || !name || !cnic || !dob || !maritalStatus || !gender) {
    alert("Please fill all family member fields");
    return;
  }

  const member = { relationship, name, cnic, dob, maritalStatus, gender };
  familyMembers.push(member);

  const row = `<tr>
    <td>${relationship}</td>
    <td>${name}</td>
    <td>${cnic}</td>
    <td>${dob}</td>
    <td>${maritalStatus}</td>
    <td>${gender}</td>
  </tr>`;
  document.querySelector("#familyTable tbody").insertAdjacentHTML("beforeend", row);

  document.getElementById("familyForm").reset();
});

document.getElementById("submitAll").addEventListener("click", async () => {
  const data = {
    postingPlace: document.getElementById("postingPlace").value,
    fullName: document.getElementById("fullName").value,
    designation: document.getElementById("designation").value,
    employeeCnic: document.getElementById("employeeCnic").value,
    email: document.getElementById("email").value,
    mobile: document.getElementById("mobile").value,
    bloodGroup: document.getElementById("bloodGroup").value,
    familyMembers: familyMembers
  };

  const response = await fetch("https://script.google.com/macros/s/AKfycbzulLZte9SB0us5XedN2SmZfD-_Pw78eBIgTHp4YBFx-4AifsvhvuVHVpN8019jjsHn0A/exec", {
    method: "POST",
    body: JSON.stringify(data)
  });

  const result = await response.json();
  document.getElementById("responseMessage").innerText = result.message;

  if (result.status === "success") {
    document.getElementById("employeeForm").reset();
    document.getElementById("familyForm").reset();
    document.querySelector("#familyTable tbody").innerHTML = "";
    familyMembers = [];
  }
});
</script>
</body>
</html>
