<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Employee Form</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
  <h2 class="text-center mb-4">Employee & Family Information Form</h2>

  <form id="dataForm" class="card p-4 shadow-sm">
    <h4>Employee Information</h4>
    <div class="mb-3">
      <label class="form-label">Posting Place</label>
      <input type="text" class="form-control" id="postingPlace" required>
    </div>
    <div class="mb-3">
      <label class="form-label">Full Name</label>
      <input type="text" class="form-control" id="fullName" required>
    </div>
    <div class="mb-3">
      <label class="form-label">Designation</label>
      <select id="designation" class="form-select" required>
        <option value="">Select Designation</option>
        <option>Clerk</option>
        <option>Assistant</option>
        <option>Officer</option>
      </select>
    </div>
    <div class="mb-3">
      <label class="form-label">CNIC</label>
      <input type="text" class="form-control" id="employeeCnic" required>
    </div>
    <div class="mb-3">
      <label class="form-label">Email (Optional)</label>
      <input type="email" class="form-control" id="email">
    </div>
    <div class="mb-3">
      <label class="form-label">Blood Group</label>
      <select id="bloodGroup" class="form-select">
        <option value="">Select Blood Group</option>
        <option>A+</option><option>A-</option>
        <option>B+</option><option>B-</option>
        <option>O+</option><option>O-</option>
        <option>AB+</option><option>AB-</option>
      </select>
    </div>
    <div class="mb-3">
      <label class="form-label">Mobile Number (Optional)</label>
      <input type="text" class="form-control" id="mobile">
    </div>

    <h4 class="mt-4">Family Members</h4>
    <div id="familyTableContainer" class="mb-3"></div>
    <button type="button" class="btn btn-secondary mb-3" onclick="addFamilyMember()">+ Add Family Member</button>

    <button type="submit" class="btn btn-primary">Submit</button>
    <p id="responseMessage" class="mt-3"></p>
  </form>
</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbxiTNPZ6hJbsgVUujUKpKkHDXe9T9IOmvYaOiTFSHz3kS5K9rt-kFkrJ0yXqpuSKAVj6A/exec"; // Replace with your Apps Script Web App URL

function addFamilyMember() {
  let container = document.getElementById("familyTableContainer");

  if (!document.getElementById("familyTable")) {
    container.innerHTML = `
      <table class="table table-bordered" id="familyTable">
        <thead>
          <tr>
            <th>Relationship</th>
            <th>Full Name</th>
            <th>CNIC</th>
            <th>Date of Birth</th>
            <th>Marital Status</th>
            <th>Job Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    `;
  }

  const tbody = document.querySelector("#familyTable tbody");

  const row = document.createElement("tr");
  row.innerHTML = `
    <td>
      <select class="form-select" name="relationship" required>
        <option value="">Select</option>
        <option>Spouse</option>
        <option>Son</option>
        <option>Daughter</option>
        <option>Father</option>
        <option>Mother</option>
      </select>
    </td>
    <td><input type="text" class="form-control" name="memberName" required></td>
    <td><input type="text" class="form-control" name="memberCnic" required></td>
    <td><input type="date" class="form-control" name="memberDob" required></td>
    <td>
      <select class="form-select" name="maritalStatus">
        <option value="">Select</option>
        <option>Single</option>
        <option>Married</option>
      </select>
    </td>
    <td>
      <select class="form-select" name="jobStatus">
        <option value="">Select</option>
        <option>Student</option>
        <option>Employed</option>
        <option>Unemployed</option>
      </select>
    </td>
    <td><button type="button" class="btn btn-danger btn-sm" onclick="this.closest('tr').remove()">X</button></td>
  `;
  tbody.appendChild(row);
}

document.getElementById("dataForm").addEventListener("submit", e => {
  e.preventDefault();

  const employee = {
    postingPlace: document.getElementById("postingPlace").value,
    fullName: document.getElementById("fullName").value,
    designation: document.getElementById("designation").value,
    cnic: document.getElementById("employeeCnic").value,
    email: document.getElementById("email").value,
    bloodGroup: document.getElementById("bloodGroup").value,
    mobile: document.getElementById("mobile").value
  };

  const rows = document.querySelectorAll("#familyTable tbody tr");
  const familyMembers = Array.from(rows).map(row => ({
    relationship: row.querySelector("[name='relationship']").value,
    name: row.querySelector("[name='memberName']").value,
    cnic: row.querySelector("[name='memberCnic']").value,
    dob: row.querySelector("[name='memberDob']").value,
    maritalStatus: row.querySelector("[name='maritalStatus']").value,
    jobStatus: row.querySelector("[name='jobStatus']").value
  }));

  fetch(scriptURL, {
    method: "POST",
    body: new URLSearchParams({
      employee: JSON.stringify(employee),
      familyMembers: JSON.stringify(familyMembers)
    })
  })
  .then(res => res.json())
  .then(data => {
    document.getElementById("responseMessage").innerText = data.message;
  })
  .catch(err => {
    document.getElementById("responseMessage").innerText = "Error: " + err.message;
  });
});
</script>
</body>
</html>
